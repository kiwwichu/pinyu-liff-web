<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å¿«æ¨‚å°ç‹— Pinyuï½œé ç´„è¨­å®š</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <!-- CSS å°‡åœ¨ç¬¬ 2 æ®µæä¾› -->
  <link rel="stylesheet" href="style.css">

</head>
<body>
  <div class="page">

    <!-- Header -->
    <header>è¨­å®šé ç´„éœ€æ±‚</header>

    <!-- æ­¥é©ŸæŒ‡ç¤º -->
    <div class="step-indicator">
  <div class="step-dot" data-step="1">
    <div class="step-circle"></div><span>è»Šé¦¬è²»</span>
  </div>
  <span class="step-sep">â€º</span>

  <div class="step-dot" data-step="2">
    <div class="step-circle"></div><span>æœå‹™æ—¥æœŸ</span>
  </div>
  <span class="step-sep">â€º</span>

  <div class="step-dot" data-step="3">
    <div class="step-circle"></div><span>æœå‹™æ–¹æ¡ˆ</span>
  </div>
  <span class="step-sep">â€º</span>

  <div class="step-dot" data-step="4">
    <div class="step-circle"></div><span>åŠ è³¼é …ç›®</span>
  </div>
  <span class="step-sep">â€º</span>

  <div class="step-dot" data-step="5">
    <div class="step-circle"></div><span>è©¦ç®—å ±åƒ¹</span>
  </div>
</div>


    <!-- å…§å®¹å€ -->
    <div class="content">

      <!-- STEP 1ï¼šåœ°å€ / è»Šé¦¬è²» -->
      <div class="step-panel" id="step1">

        <div class="section-title">ç¢ºèªæœå‹™åœ°å€èˆ‡è·é›¢</div>
        <div class="section-sub">
          æ–°å®¢éœ€å¡«å¯«è·é›¢ä»¥è©¦ç®—è»Šé¦¬è²»ï¼›èˆŠå®¢å°‡è‡ªå‹•å¸¶å…¥è³‡æ–™ã€‚
        </div>

        <!-- æ–°å®¢ -->
        <div id="newCustomerBlock">
          <div class="summary-box">
            <strong>ğŸ§­ å¦‚ä½•ç¢ºèªè·é›¢ï¼Ÿ</strong><br>
            1. æ‰“é–‹ Google Maps<br>
            2. æœå°‹ã€Œä¸­å±±æ·é‹ç«™ â†’ æ‚¨çš„åœ°å€ã€<br>
            3. é¸ã€Œæ©Ÿè»Šæ¨¡å¼ ğŸ›µã€å³å¯çœ‹åˆ°å…¬é‡Œæ•¸<br>
            4. ä¸‹æ–¹è¼¸å…¥ Google Maps é¡¯ç¤ºæ•¸å­—ï¼ˆå°æ•¸é»æœƒè‡ªå‹•å››æ¨äº”å…¥ï¼‰<br><br>
            è‹¥ä¸ç¢ºå®šï¼Œä¹Ÿå¯ä»¥å°‡åœ°å€ç§è¨Šçµ¦æˆ‘ï¼Œæˆ‘æœƒå”åŠ©æŸ¥è©¢ ğŸ’›
          </div>

          <div class="field-group">
            <div class="field-label">è«‹è¼¸å…¥å…¬é‡Œæ•¸</div>
            <input type="number" step="0.1" id="distanceKm" class="text-input"
              placeholder="ä¾‹å¦‚ï¼š4.7 æˆ– 12.3">
          </div>

          <div class="summary-box" id="fareResultBox">
            å°šæœªè¼¸å…¥å…¬é‡Œæ•¸ã€‚
          </div>
        </div>

        <!-- èˆŠå®¢ -->
        <div id="oldCustomerBlock" class="hidden">
          <div class="summary-box" id="oldCustomerSummary">
            <!-- Apps Script initBooking æœƒå¡«å…¥ -->
          </div>
        </div>

      </div>

      <!-- STEP 2ï¼šæ—¥æœŸèˆ‡é è¨­é »ç‡ -->
      <div class="step-panel hidden" id="step2">

        <div class="section-title">é¸æ“‡æœå‹™æœŸé–“èˆ‡é »ç‡</div>
        <div class="section-sub">ä¸‹ä¸€æ­¥å¯å†å¾®èª¿æ¯æ—¥æ™‚æ®µã€‚</div>

        <div class="field-group">
          <div class="field-label">æœå‹™æ—¥æœŸå€é–“</div>
          <div class="date-row">
            <input type="date" id="startDate" class="date-input">
            <span>è‡³</span>
            <input type="date" id="endDate" class="date-input">
          </div>
        </div>

        <div class="field-group">
          <div class="field-label">é è¨­é »ç‡</div>

          <div class="options-grid">

          <div class="option-card" data-template="daily1-evening">
            <div class="option-main">
              <div class="option-title">æ¯æ—¥ 1 æ¬¡ï¼ˆé è¨­æ™šä¸Šï¼‰</div>
              <div class="option-desc">é©åˆçŸ­æš«å¤–å‡ºã€æ¯›å­©ä½œæ¯ç©©å®šæ™‚çš„å°å°é™ªä¼´ã€‚</div>
            </div>
            <div class="option-tag">å¸¸è¦‹é¸é …</div>
          </div>

            <div class="option-card" data-template="daily2-morning-evening">
    <div class="option-main">
      <div class="option-title">æ¯æ—¥ 2 æ¬¡ï¼ˆæ—©ï¼‹æ™šï¼‰</div>
      <div class="option-desc">æ—©æ™šå„ä¸€è¶Ÿï¼Œå…¼é¡§æ¸…æ½”è£œæ°´ï¼Œä¹Ÿé™ªæ¯›å­©åº¦éä¸€å¤©çš„é‡é»æ™‚åˆ»ã€‚</div>
    </div>
    <div class="option-tag">æœ€å¤šäººé¸æ“‡</div>
          </div>

              <div class="option-card" data-template="daily3-morning-afternoon-evening">
                <div class="option-main">
                  <div class="option-title">æ¯æ—¥ 3 æ¬¡ï¼ˆæ—©ï¼‹åˆï¼‹æ™šï¼‰</div>
                  <div class="option-desc">çµ¦éœ€è¦å¤šä¸€é»å®‰å…¨æ„Ÿçš„æ¯›å­©ï¼Œä¸€å¤©ä¸‰æ¬¡æº«æŸ”é™ªä¼´ã€‚</div>
                </div>
                <div class="option-tag">æ›´å¤šé—œå¿ƒæ™‚åˆ»</div>
              </div>

              <div class="option-card" data-template="custom-empty">
                <div class="option-main">
                  <div class="option-title">å®Œå…¨è‡ªè¨‚</div>
                  <div class="option-desc">å¯ä¾æ¯›å­©ç¿’æ…£è‡ªç”±èª¿æ•´ï¼Œä¸‹ä¸€æ­¥å‹¾é¸é©åˆçš„æ™‚æ®µå³å¯ã€‚</div>
                </div>
                <div class="option-tag">è‡ªç”±å½ˆæ€§</div>
              </div>


          </div>
        </div>

        <div class="summary-box" id="step2Summary">å°šæœªé¸æ“‡æœŸé–“èˆ‡é »ç‡ã€‚</div>

      </div>

      <!-- STEP 3ï¼šæ¯æ—¥æ™‚æ®µ -->
      <div class="step-panel hidden" id="step3">
        <div class="section-title">èª¿æ•´æ¯æ—¥åˆ°è¨ªæ™‚æ®µ</div>
        <div class="section-sub">
          é»é¸å³å¯å‹¾é¸ï¼å–æ¶ˆï¼š<br>
          æ—©ä¸Š 09:00â€“12:00ã€ä¸‹åˆ 13:00â€“17:00ã€æ™šä¸Š 18:00â€“21:00ã€æ·±å¤œ 22:00â€“23:00ã€‚
        </div>

        <div id="dayList" class="day-list"></div>

        <div class="summary-box" id="step3Summary">å°šæœªé¸æ“‡ä»»ä½•åˆ°è¨ªæ™‚æ®µã€‚</div>
      </div>

      <!-- STEP 4ï¼šæœå‹™é¡å‹ -->
      <div class="step-panel hidden" id="stepServiceType">
      <div id="serviceTypeTopSummary" class="selection-summary"></div>


        <div class="section-title">é¸æ“‡æœå‹™é¡å‹</div>
        <div class="section-sub">æ•´æ®µæœŸé–“çš†ä½¿ç”¨ç›¸åŒæœå‹™é¡å‹ã€‚</div>

        <div class="options-grid">
          <div class="option-card" data-service="åˆ°åºœç…§é¡§">
            <div class="option-main">
              <div class="option-title">åˆ°åºœç…§é¡§</div>
              <div class="option-desc">é¤µé£Ÿï½œè£œæ°´ï½œæ¸…æ½”ï½œé™ªä¼´ï½œç…§ç‰‡å›å ±</div>
            </div>
          </div>

          <div class="option-card" data-service="é›ç‹—æ•£æ­¥">
            <div class="option-main">
              <div class="option-title">é›ç‹—æ•£æ­¥</div>
              <div class="option-desc">æ•£æ­¥ï½œæ’ä¾¿è§€å¯Ÿï½œå®‰å…¨äº’å‹•</div>
            </div>
          </div>

          <div class="option-card" data-service="é•·æ™‚é–“é™ªä¼´">
            <div class="option-main">
              <div class="option-title">é•·æ™‚é–“é™ªä¼´</div>
              <div class="option-desc">é©åˆåˆ†é›¢ç„¦æ…®ã€éœ€è¦é™ªä¼´çš„æ¯›å­©</div>
            </div>
          </div>
        </div>

        <div class="summary-box" id="serviceTypeSummary">
          å°šæœªé¸æ“‡æœå‹™é¡å‹ã€‚
        </div>

      </div>

      <!-- STEP 5ï¼šæ–¹æ¡ˆï¼ˆ30/45/60 åˆ†é˜ï¼‰ -->
      <div class="step-panel hidden" id="stepPlan">

        <div class="section-title">é¸æ“‡æœå‹™æ–¹æ¡ˆ</div>
        <div class="section-sub">ä¸åŒæ™‚é•·é©åˆä¸åŒæ¯›å­©éœ€æ±‚ã€‚</div>

        <div class="options-grid">
          <div class="option-card" data-plan="30" data-price="350">
            <div class="option-main">
              <div class="option-title">30 åˆ†é˜ â€” NT.350</div>
              <div class="option-desc">åŸºç¤æœå‹™ï¼šé¤µé£Ÿã€è£œæ°´ã€æ¸…æ½”ã€ç´€éŒ„</div>
            </div>
            <div class="option-tag">åŸºç¤</div>
          </div>

          <div class="option-card" data-plan="45" data-price="450">
            <div class="option-main">
              <div class="option-title">45 åˆ†é˜ â€” NT.450</div>
              <div class="option-desc">å¢åŠ é™ªä¼´ã€æ¸…æ½”ã€äº’å‹•æ™‚é–“</div>
            </div>
            <div class="option-tag">åŠ å¼·</div>
          </div>

          <div class="option-card" data-plan="60" data-price="500">
            <div class="option-main">
              <div class="option-title">60 åˆ†é˜ â€” NT.500</div>
              <div class="option-desc">é•·æ™‚é–“é™ªä¼´æˆ–é«˜éœ€æ±‚æ¯›å­©</div>
            </div>
            <div class="option-tag">æœ€ç†±é–€</div>
          </div>
        </div>

        <div class="summary-box" id="planSummary">
          å°šæœªé¸æ“‡æ–¹æ¡ˆã€‚
        </div>

      </div>

      <!-- STEP 6ï¼šæ¯›å­©æ•¸é‡ -->
      <div class="step-panel hidden" id="stepPet">

        <div class="section-title">æ¯›å­©è³‡è¨Š</div>
        <div class="section-sub">ä»¥ä¸‹è³‡è¨Šå½±éŸ¿éƒ¨åˆ†åŠ åƒ¹é …ç›®ã€‚</div>

        <div class="field-group">
          <div class="field-label">
            ç‹—ç‹—éš»æ•¸ï¼ˆé›ç‹—æ•£æ­¥ç¬¬äºŒéš»èµ· +100ï¼è¨ªè¦–ï¼‰
          </div>
          <input type="number" id="dogCount" class="text-input" min="0" value="0">
        </div>

        <div class="field-group">
          <div class="field-label">
            è²“å’ªéš»æ•¸ï¼ˆç¬¬ä¸‰éš»ä»¥ä¸Šè¦–æƒ…æ³åŠ åƒ¹ï¼‰
          </div>
          <input type="number" id="catCount" class="text-input" min="0" value="0">
        </div>

        <div class="summary-box" id="multiPetSummary">
          å°šæœªè¼¸å…¥æ¯›å­©æ•¸é‡ã€‚
        </div>

      </div>

      <!-- STEP 7ï¼šåŠ è³¼é …ç›® -->
      <div class="step-panel hidden" id="stepAddons">

        <div class="section-title">åŠ è³¼é …ç›®ï¼ˆå¯é¸ï¼‰</div>
        <div class="section-sub">è‹¥æ¯›å­©æœ‰é¡å¤–éœ€æ±‚ï¼Œå¯æ–¼æ­¤è™•åŠ è³¼ã€‚</div>

        <div class="checkbox-list">

          <label class="checkbox-item">
            <input type="checkbox" data-addon="medicine" data-price="50">
            é¤µè—¥æœå‹™ï¼ˆ+50ï¼æ¬¡ï¼‰
          </label>

          <label class="checkbox-item">
            <input type="checkbox" data-addon="multi-dog" data-price="100">
            å¤šå¯µå®¶åº­ï¼ˆç¬¬äºŒéš»ç‹—èµ· +100ï¼æ¬¡ï¼‰
          </label>

        </div>

        <div class="summary-box" id="addonSummary">
          å°šæœªé¸æ“‡åŠ è³¼é …ç›®ã€‚
        </div>

      </div>

      <!-- STEP 8ï¼šè©¦ç®—å ±åƒ¹ -->
      <div class="step-panel hidden" id="stepQuote">

        <div class="section-title">è©¦ç®—æœ¬æ¬¡é ç´„é‡‘é¡</div>
        <div class="section-sub">
          ç³»çµ±ä¾ç…§æ‚¨çš„è¨­å®šè©¦ç®—é‡‘é¡ï¼Œ<br>å¯¦éš›é‡‘é¡ä»ä»¥ Pinyu æœ€çµ‚ç¢ºèªç‚ºä¸» ğŸ’›
        </div>

        <div class="quote-card">

          <div class="quote-header">
            <div>
              <div class="quote-range" id="quoteRange"></div>
              <div class="quote-service-type" id="quoteServiceType"></div>
            </div>
            <div class="quote-total" id="quoteTotal"></div>
          </div>

          <div class="quote-section">
            <div class="quote-section-title">1. æœå‹™é …ç›®</div>

            <div class="quote-line">
              <span>æœå‹™æ—¥æœŸ</span>
              <span id="quoteDateRangeText"></span>
            </div>

            <div class="quote-line">
              <span>æ™‚æ•¸</span>
              <span id="quoteDuration"></span>
            </div>

            <div class="quote-line">
              <span>æœå‹™æ¬¡æ•¸</span>
              <span id="quoteVisitCount"></span>
            </div>

            <div class="quote-line">
              <span>æœå‹™å–®åƒ¹</span>
              <span id="quoteUnitPriceText"></span>
            </div>

            <div class="quote-line">
              <span>è»Šé¦¬è²»</span>
              <span id="quoteFareText"></span>
            </div>

            <div class="quote-line">
              <span>å¤šå¯µåŠ åƒ¹</span>
              <span id="quoteMultiPet"></span>
            </div>

            <div class="quote-line">
              <span>åŠ è³¼é …ç›®</span>
              <span id="quoteAddons"></span>
            </div>

            <div class="quote-subtotal" id="quoteSubtotal"></div>
          </div>

          <div class="quote-section">
            <div class="quote-line">
              <span>è¨‚é‡‘</span>
              <span id="quoteDepositText" class="highlight-text">å…è¨‚é‡‘ï¼ˆå¸¸å®¢ï¼‰</span>
            </div>

            <div class="quote-line">
              <span>å‚™è¨»</span>
              <span>æ­¤ç‚ºç³»çµ±è©¦ç®—é‡‘é¡ï¼Œå¯¦éš›é‡‘é¡ä»éœ€ç”± Pinyu æœ€çµ‚ç¢ºèªã€‚</span>
            </div>
          </div>

        </div>

        <div class="summary-box" id="quoteDebugBox">
          ï¼ˆé–‹ç™¼ç”¨ï¼‰é€å‡ºæ™‚å°‡ä¸€ä½µå‚³é€å®Œæ•´æ˜ç´°ã€‚
        </div>

      </div>

    </div>

    <!-- åº•éƒ¨æŒ‰éˆ• -->
    <div class="bottom-bar">
      <button class="secondary-btn hidden" id="prevBtn">â† ä¸Šä¸€æ­¥</button>
      <button class="primary-btn" id="nextBtn">ä¸‹ä¸€æ­¥</button>
      <div class="sub-text" id="hintText">
        æœƒå…ˆå»ºç«‹é ç´„éœ€æ±‚ï¼Œä¿å§†ç¢ºèªå¾Œå†èˆ‡æ‚¨æ•²å®šå¯¦éš›é‡‘é¡èˆ‡æ™‚é–“ ğŸ¾
      </div>
    </div>

  </div>
<style>
 /* ========== å…¨åŸŸæ¨£å¼ ========== */
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: #f3f7fc;
  color: #333;
}

.page {
  max-width: 480px;
  margin: 0 auto;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  background: #ffffff;
}

/* Header */
header {
  padding: 12px 16px;
  font-size: 16px;
  font-weight: 700;
  text-align: center;
  border-bottom: 1px solid #d0e2ff;
  color: #144a7e;
  background: #ffffff;
}

/* ========== æ­¥é©ŸæŒ‡ç¤ºå™¨ ========== */
.step-indicator {
  display: flex;
  justify-content: center;
  gap: 14px;
  padding: 12px 8px 0;
  font-size: 12px;
  color: #7a8baa;
  flex-wrap: wrap;
}

.step-dot {
  display: flex;
  align-items: center;
  gap: 4px;
  white-space: nowrap;
}

.step-circle {
  width: 8px;
  height: 8px;
  border-radius: 999px;
  background: #d1e4ff;
}

.step-dot.active .step-circle {
  background: #48a2e8;
}

.step-dot.active span {
  color: #225f9f;
  font-weight: 600;
}

.step-sep {
  color: #c4d7f1;
  font-size: 12px;
}


/* ========== å…§å®¹å€ ========== */
.content {
  padding: 12px 16px 16px;
  flex: 1;
  overflow-y: auto;
}

.section-title {
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 6px;
  color: #123456;
}

.section-sub {
  font-size: 13px;
  color: #667a95;
  margin-bottom: 12px;
  line-height: 1.6;
}

.selection-summary {
  background: #eef6ff;
  padding: 10px 16px;
  margin-top: 16px;
  border-radius: 10px;
  color: #3566a8;
  font-size: 14px;
}


/* ========== è¡¨å–®æ¬„ä½ ========== */
.field-group {
  margin-bottom: 16px;
}

.field-label {
  font-size: 14px;
  margin-bottom: 6px;
  color: #3f4f66;
}

.text-input,
.date-input {
  width: 100%;
  padding: 10px 12px;
  border-radius: 10px;
  border: 1px solid #cfe0f5;
  background: #ffffff;
  font-size: 14px;
  box-sizing: border-box;
}

.text-input:focus,
.date-input:focus {
  border-color: #48a2e8;
  outline: none;
}

.date-row {
  display: flex;
  align-items: center;
  gap: 8px;
}

.date-row span {
  font-size: 12px;
  color: #7a8baa;
}

/* ========== é¸é …å¡ (Option Card) ========== */
.options-grid {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.option-card {
  border-radius: 14px;
  border: 1px solid #d1e4ff;
  background: #ffffff;
  padding: 12px 14px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: 0.2s ease;
}

.option-card.active {
  background: #e9f3ff;
  border-color: #48a2e8;
  box-shadow: 0 2px 8px rgba(72, 162, 232, 0.25);
}

.option-main {
  display: flex;
  flex-direction: column;
  gap: 3px;
}

.option-title {
  font-size: 15px;
  font-weight: 600;
  color: #123456;
}

.option-desc {
  font-size: 12px;
  color: #6c7a8f;
}

.option-tag {
  font-size: 11px;
  background: #dff0ff;
  padding: 3px 8px;
  border-radius: 999px;
  color: #1c5b9f;
}

/* ========== æ‘˜è¦æ¡† (Summary Box) ========== */
.summary-box {
  background: #f0f6ff;
  border: 1px solid #d1e4ff;
  padding: 12px;
  border-radius: 12px;
  font-size: 13px;
  line-height: 1.7;
  margin-bottom: 16px;
  color: #3f4f66;
}

/* ========== Step 3ï¼šæ¯æ—¥æ™‚æ®µ ========== */
.day-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.day-row {
  background: #f7fbff;
  border: 1px solid #dce8fa;
  border-radius: 12px;
  padding: 10px 12px;
}

.day-row-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 6px;
  font-size: 14px;
  color: #123456;
}

.day-row-header span:last-child {
  font-size: 12px;
  color: #738099;
}

.slot-chips {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.slot-chip {
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid #cfe3fb;
  background: #ffffff;
  font-size: 12px;
  cursor: pointer;
  color: #3f4f66;
  white-space: nowrap;
}

.slot-chip small {
  font-size: 10px;
  margin-left: 3px;
  color: #8695a8;
}

.slot-chip.active {
  background: #dff0ff;
  border-color: #48a2e8;
  color: #1d5fae;
}

/* ========== å‹¾é¸æ¡†åˆ—è¡¨ ========== */
.checkbox-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.checkbox-item {
  font-size: 14px;
  color: #3f4f66;
  display: flex;
  align-items: center;
  gap: 6px;
}

/* ========== å ±åƒ¹å¡ Quote Card ========== */
.quote-card {
  border-radius: 16px;
  border: 1px solid #d3e3f8;
  background: #ffffff;
  padding: 16px 14px 12px;
  font-size: 13px;
}

.quote-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.quote-range {
  font-size: 15px;
  font-weight: 700;
  color: #123456;
}

.quote-service-type {
  font-size: 12px;
  color: #6d7b90;
}

.quote-total {
  font-size: 20px;
  font-weight: 700;
  color: #e28c27;
}

.quote-section {
  border-top: 1px dashed #cbd8ee;
  padding-top: 10px;
  margin-top: 10px;
}

.quote-section-title {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 6px;
  color: #123456;
}

.quote-line {
  display: flex;
  justify-content: space-between;
  margin-bottom: 6px;
  font-size: 13px;
  color: #4b5e7c;
}

.quote-line span:first-child {
  color: #7a8baa;
}

.quote-subtotal {
  margin-top: 8px;
  font-size: 15px;
  font-weight: 700;
  text-align: right;
  color: #123456;
}

.highlight-text {
  color: #e28c27;
  font-weight: 700;
}

/* ========== åº•éƒ¨æŒ‰éˆ•å€ ========== */
.bottom-bar {
  padding: 12px 16px 18px;
  border-top: 1px solid #d0e2ff;
  background: #ffffff;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.primary-btn,
.secondary-btn {
  width: 100%;
  border-radius: 999px;
  padding: 12px 0;
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
  border: none;
}

.primary-btn {
  background: #48a2e8;
  color: #ffffff;
  box-shadow: 0 3px 8px rgba(72, 162, 232, 0.25);
}

.primary-btn:disabled {
  opacity: 0.5;
  cursor: default;
  box-shadow: none;
}

.secondary-btn {
  background: #e9f3ff;
  color: #234e7d;
}

.sub-text {
  font-size: 12px;
  text-align: center;
  color: #6c7a8f;
  line-height: 1.6;
}

.hidden {
  display: none;
}

</style>
  <!-- JS å°‡åœ¨ç¬¬ 3ï½5 æ®µæä¾› -->
  <script>
/* ========== å…¨åŸŸè®Šæ•¸ ========== */

// å¾ Apps Script å¸¶å…¥
let familyId = "";
let isNewCustomer = true;
let farePerVisit = 0;
let depositText = "éœ€è¨‚é‡‘";
let hasValidDistance = false;

// é è¨­æœå‹™é¡å‹
let serviceType = "åˆ°åºœç…§é¡§";   

// é è¨­æ–¹æ¡ˆè³‡æ–™
let selectedPlan = null;
let selectedPlanPrice = 0;

// æ¯›å­©è³‡è¨Š
let dogCountValue = 0;
let catCountValue = 0;

// åŠ è³¼é …ç›®
let addons = {}; // e.g. { medicine: 50 }

// æ—¥æœŸèˆ‡æ’ç¨‹
let startDate = null;
let endDate = null;
let selectedTemplate = null;

// æ¯æ—¥æ™‚æ®µæ’ç¨‹ mapï¼š{ "2025-01-01": Set(["MORNING", "EVENING"]) }
let schedule = {};

// Step æ§åˆ¶
let currentStep = 1;

// DOM å¿«å–
const stepPanels = {
  1: document.getElementById("step1"),
  2: document.getElementById("step2"),
  3: document.getElementById("step3"),
  4: document.getElementById("stepServiceType"),
  5: document.getElementById("stepPlan"),
  6: document.getElementById("stepPet"),
  7: document.getElementById("stepAddons"),
  8: document.getElementById("stepQuote"),
};

const stepDots = document.querySelectorAll(".step-dot");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById('nextBtn');
const hintText = document.getElementById("hintText");

/* ========== Step UI æ›´æ–° ========== */
function updateStepUI() {

  // éš±è—æ‰€æœ‰ step
  Object.values(stepPanels).forEach(p => p.classList.add("hidden"));
  stepPanels[currentStep].classList.remove("hidden");

  // Step indicator æ¨£å¼
  stepDots.forEach(dot => {
    const step = Number(dot.dataset.step);
    dot.classList.toggle("active", step === currentStep);
  });

  // ä¸‹æ–¹æç¤ºèˆ‡æŒ‰éˆ•æ–‡å­—
  if (currentStep === 1) {
    prevBtn.classList.add("hidden");
    nextBtn.textContent = "ä¸‹ä¸€æ­¥";
    hintText.textContent = "å…ˆç¢ºèªæ­¤æ¬¡æœå‹™åœ°å€èˆ‡è»Šé¦¬è²»ï¼Œå†é€²å…¥æ—¥æœŸè¨­å®š ğŸ¾";

  } else if (currentStep === 2) {
    prevBtn.classList.remove("hidden");
    nextBtn.textContent = "ä¸‹ä¸€æ­¥";
    hintText.textContent = "ä¹‹å¾Œé‚„å¯é‡å°å€‹åˆ¥æ—¥æœŸèª¿æ•´æ™‚æ®µå”· ğŸ’›";

  } else if (currentStep === 3) {
    prevBtn.classList.remove("hidden");
    nextBtn.textContent = "ä¸‹ä¸€æ­¥";
    hintText.textContent = "è«‹å‹¾é¸æ¯æ—¥è¦åˆ°è¨ªçš„æ™‚æ®µã€‚";

  } else if (currentStep === 4) {
    prevBtn.classList.remove("hidden");
    nextBtn.textContent = "ä¸‹ä¸€æ­¥";
    hintText.textContent = "æ•´æ®µæœŸé–“æœƒæ¡ç”¨ç›¸åŒæœå‹™é¡å‹ã€‚";

  } else if (currentStep === 5) {
    prevBtn.classList.remove("hidden");
    nextBtn.textContent = "ä¸‹ä¸€æ­¥";
    hintText.textContent = "é¸æ“‡æ¯æ¬¡åˆ°è¨ªçš„æ™‚é•·æ–¹æ¡ˆã€‚";

  } else if (currentStep === 6) {
    prevBtn.classList.remove("hidden");
    nextBtn.textContent = "ä¸‹ä¸€æ­¥";
    hintText.textContent = "è¼¸å…¥æ¯›å­©æ•¸é‡ä»¥è¨ˆç®—æ˜¯å¦éœ€è¦åŠ åƒ¹ã€‚";

  } else if (currentStep === 7) {
    prevBtn.classList.remove("hidden");
    nextBtn.textContent = "è©¦ç®—å ±åƒ¹";
    hintText.textContent = "åŠ è³¼é …ç›®å¦‚é¤µè—¥ç­‰å¯åœ¨æ­¤é¸æ“‡ã€‚";

  } else if (currentStep === 8) {
    prevBtn.classList.remove("hidden");
    nextBtn.textContent = "é€å‡ºé ç´„éœ€æ±‚";
    hintText.textContent = "ç³»çµ±å°‡ç”¢ç”Ÿè©¦ç®—é‡‘é¡ï¼Œå¯¦éš›ä»¥ Pinyu æœ€çµ‚ç¢ºèªç‚ºä¸» ğŸ¾";
  }
}



/* ========== æ–°å®¢è»Šé¦¬è²»è¨ˆç®—é‚è¼¯ ========== */

const distanceInput = document.getElementById("distanceKm");
const fareResultBox = document.getElementById("fareResultBox");

function calcFareFromDistance(kmValue) {
  const roundedKm = Math.round(kmValue);
  if (roundedKm <= 5) return { km: roundedKm, fare: 0 };
  return { km: roundedKm, fare: (roundedKm - 5) * 40 };
}

// ä½¿ç”¨è€…è¼¸å…¥å…¬é‡Œæ•¸ â†’ å³æ™‚è¨ˆç®—
distanceInput?.addEventListener("input", () => {
  const km = parseFloat(distanceInput.value);

  if (isNaN(km) || km <= 0) {
    fareResultBox.textContent = "å°šæœªè¼¸å…¥å…¬é‡Œæ•¸ã€‚";
    farePerVisit = 0;
    hasValidDistance = false;  // âœ… ç„¡æ•ˆè¼¸å…¥
    return;
  }

  const result = calcFareFromDistance(km);

  farePerVisit = result.fare;
  hasValidDistance = true;     // âœ… æœ‰è¼¸å…¥æœ‰æ•ˆå…¬é‡Œæ•¸

  fareResultBox.innerHTML = `
    å››æ¨äº”å…¥å¾Œè·é›¢ï¼š<strong>${result.km} å…¬é‡Œ</strong><br>
    é ä¼°è»Šé¦¬è²»ï¼š<strong>${result.fare} å…ƒ / æ¬¡</strong>
  `;
});




/* ========== èˆŠå®¢ï¼æ–°å®¢ InitBookingï¼ˆApps Scriptï¼‰ ========== */

const mockUserId = "TEST_USER"; // å…ˆè®“ç¨‹å¼èƒ½è·‘ï¼Œä¹‹å¾Œæ›æˆ LIFF userId

const oldCustomerBlock = document.getElementById("oldCustomerBlock");
const newCustomerBlock = document.getElementById("newCustomerBlock");
const oldCustomerSummary = document.getElementById("oldCustomerSummary");

function initBooking() {
  fetch("/api/booking", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      action: "initBooking",
      userId: mockUserId,
    }),
  })
    .then(r => r.json())
    .then(data => {
      if (!data || !data.ok) throw new Error("initBooking not ok");

      isNewCustomer = data.isNewCustomer;
      familyId = data.familyId || "";
      farePerVisit = data.farePerVisit || 0;

      depositText = data.isRegular
        ? "å…è¨‚é‡‘ï¼ˆå¸¸å®¢ï¼‰"
        : "éœ€è¨‚é‡‘ï¼ˆå¯¦éš›é‡‘é¡ç”± Pinyu å‘ŠçŸ¥ï¼‰";

      if (isNewCustomer) {
        newCustomerBlock.classList.remove("hidden");
        oldCustomerBlock.classList.add("hidden");
      } else {
        newCustomerBlock.classList.add("hidden");
        oldCustomerBlock.classList.remove("hidden");

        oldCustomerSummary.innerHTML = `
          <strong>å¸¸å®¢è³‡æ–™</strong><br>
          ç™»è¨˜åœ°å€ï¼š${data.address || "æœªå¡«å¯«"}<br>
          è»Šé¦¬è²»ï¼š${farePerVisit} å…ƒï¼æ¬¡<br>
          è‹¥æœ‰è®Šæ›´ï¼Œå¯æ–¼å‚™è¨»å‘ŠçŸ¥ Pinyuã€‚
        `;
      }
    })
    .catch(err => {
      console.warn("initBooking failed:", err);
      // è‹¥å¤±æ•— â†’ ç•¶ä½œæ–°å®¢
      isNewCustomer = true;
      newCustomerBlock.classList.remove("hidden");
      oldCustomerBlock.classList.add("hidden");
    });
}

// åˆå§‹åŒ–
updateStepUI();
initBooking();


    /* ============================================================
   æ—¥æœŸè™•ç†å·¥å…·
============================================================ */

function formatDateKey(d) {
  const y = d.getFullYear();
  const m = String(d.getMonth() + 1).padStart(2, "0");
  const day = String(d.getDate()).padStart(2, "0");
  return `${y}-${m}-${day}`;
}

function parseDateStr(str) {
  if (!str) return null;
  const [y, m, d] = str.split("-").map(Number);
  return new Date(y, m - 1, d);
}

function getDateRangeArray(start, end) {
  const arr = [];
  let cur = new Date(start);
  while (cur <= end) {
    arr.push(new Date(cur));
    cur.setDate(cur.getDate() + 1);
  }
  return arr;
}

function getWeekdayName(d) {
  return ["æ—¥", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­"][d.getDay()];
}


/* ============================================================
   Step 2ï¼šæ—¥æœŸå€é–“è™•ç†
============================================================ */

const startInput = document.getElementById("startDate");
const endInput = document.getElementById("endDate");
const step2Summary = document.getElementById("step2Summary");
const optionCards = document.querySelectorAll('#step2 .option-card');

startInput.addEventListener("change", handleDateChange);
endInput.addEventListener("change", handleDateChange);

// è™•ç†æ—¥æœŸè®Šå‹•
function handleDateChange() {
  startDate = parseDateStr(startInput.value);
  endDate = parseDateStr(endInput.value);

  // å¦‚æœä½¿ç”¨è€…è¼¸å…¥éŒ¯èª¤é †åº
  if (startDate && endDate && endDate < startDate) {
    alert("çµæŸæ—¥æœŸä¸å¯æ—©æ–¼é–‹å§‹æ—¥æœŸ");
    endInput.value = "";
    endDate = null;
  }

  updateStep2Summary();
}

// æ›´æ–° Step 2 æ‘˜è¦
function updateStep2Summary() {
  if (!startDate || !endDate) {
    step2Summary.textContent = "å°šæœªé¸æ“‡æœŸé–“èˆ‡é »ç‡ã€‚";
    return;
  }

  const days = getDateRangeArray(startDate, endDate).length;

  let freqText = "å°šæœªé¸æ“‡é »ç‡";
  if (selectedTemplate === "daily1-evening") freqText = "æ¯æ—¥ 1 æ¬¡ï¼ˆæ™šä¸Šï¼‰";
  else if (selectedTemplate === "daily2-morning-evening") freqText = "æ¯æ—¥ 2 æ¬¡ï¼ˆæ—©ï¼‹æ™šï¼‰";
  else if (selectedTemplate === "daily3-morning-afternoon-evening") freqText = "æ¯æ—¥ 3 æ¬¡ï¼ˆæ—©ï¼‹åˆï¼‹æ™šï¼‰";
  else if (selectedTemplate === "custom-empty") freqText = "å®Œå…¨è‡ªè¨‚";

  step2Summary.innerHTML =
    `å·²é¸æ“‡ï¼š${startInput.value} ï½ ${endInput.value}ï¼ˆå…± ${days} å¤©ï¼‰<br>
    é è¨­é »ç‡ï¼š${freqText}`;
}


/* ============================================================
   Step 2ï¼šé »ç‡æ¨¡æ¿é¸æ“‡
============================================================ */

optionCards.forEach(card => {
  card.addEventListener("click", () => {
    optionCards.forEach(c => c.classList.remove("active"));
    card.classList.add("active");

    selectedTemplate = card.dataset.template;
    updateStep2Summary();
  });
});


/* ============================================================
   Step 3ï¼šæ¯æ—¥æ™‚æ®µå¾®èª¿
============================================================ */

// æ™‚æ®µå®šç¾©è¡¨
const SLOT_DEFS = [
  { id: "MORNING",   label: "æ—©ä¸Š", range: "09:00â€“12:00" },
  { id: "AFTERNOON", label: "ä¸‹åˆ", range: "13:00â€“17:00" },
  { id: "EVENING",   label: "æ™šä¸Š", range: "18:00â€“21:00" },
  { id: "LATE",      label: "æ·±å¤œ", range: "22:00â€“23:00" },
];

const dayList = document.getElementById("dayList");
const step3Summary = document.getElementById("step3Summary");


// ä¾æ¨¡æ¿ç”Ÿæˆ schedule
function applyTemplateToSchedule(templateId) {
  schedule = {};
  if (!startDate || !endDate) return;

  const dates = getDateRangeArray(startDate, endDate);

  dates.forEach(d => {
    const key = formatDateKey(d);
    schedule[key] = new Set();

    if (templateId === "daily1-evening") {
      schedule[key].add("EVENING");

    } else if (templateId === "daily2-morning-evening") {
      schedule[key].add("MORNING");
      schedule[key].add("EVENING");

    } else if (templateId === "daily3-morning-afternoon-evening") {
      schedule[key].add("MORNING");
      schedule[key].add("AFTERNOON");
      schedule[key].add("EVENING");

    } else if (templateId === "custom-empty") {
      // å®Œå…¨ç©ºç™½ï¼Œè®“ä½¿ç”¨è€…è‡ªè¡Œé¸
    }
  });
}


// æ¸²æŸ“æ¯æ—¥æ™‚æ®µ UI
function renderDayList() {
  if (!startDate || !endDate) return;

  dayList.innerHTML = "";
  const dates = getDateRangeArray(startDate, endDate);

  dates.forEach(d => {
    const key = formatDateKey(d);
    if (!schedule[key]) schedule[key] = new Set();

    const row = document.createElement("div");
    row.className = "day-row";

    // æ—¥æœŸæ¨™é¡Œ
    const header = document.createElement("div");
    header.className = "day-row-header";
    header.innerHTML = `
      <span>${d.getMonth() + 1}/${d.getDate()}ï¼ˆ${getWeekdayName(d)}ï¼‰</span>
      <span>é»é¸å¯å‹¾é¸ / å–æ¶ˆ</span>
    `;
    row.appendChild(header);

    // æ™‚æ®µ chips
    const chipsWrapper = document.createElement("div");
    chipsWrapper.className = "slot-chips";

    SLOT_DEFS.forEach(slot => {
      const chip = document.createElement("div");
      chip.className = "slot-chip";
      chip.dataset.date = key;
      chip.dataset.slot = slot.id;

      if (schedule[key].has(slot.id)) chip.classList.add("active");

      chip.innerHTML = `${slot.label} <small>${slot.range}</small>`;

      chip.addEventListener("click", () => toggleSlot(key, slot.id, chip));

      chipsWrapper.appendChild(chip);
    });

    row.appendChild(chipsWrapper);
    dayList.appendChild(row);
  });

  updateStep3Summary();
}


// é»é¸æ™‚æ®µ â†’ åˆ‡æ› Set è³‡æ–™
function toggleSlot(dateKey, slotId, chipElement) {
  const slotSet = schedule[dateKey];

  if (slotSet.has(slotId)) {
    slotSet.delete(slotId);
    chipElement.classList.remove("active");
  } else {
    slotSet.add(slotId);
    chipElement.classList.add("active");
  }

  schedule[dateKey] = slotSet;
  updateStep3Summary();
}


// Step 3 Summary
function updateStep3Summary() {
  let total = 0;
  let countMorning = 0,
      countAfternoon = 0,
      countEvening = 0,
      countLate = 0;

  Object.values(schedule).forEach(set => {
    set.forEach(slot => {
      total++;
      if (slot === "MORNING") countMorning++;
      if (slot === "AFTERNOON") countAfternoon++;
      if (slot === "EVENING") countEvening++;
      if (slot === "LATE") countLate++;
    });
  });

  if (total === 0) {
    step3Summary.textContent = "å°šæœªé¸æ“‡ä»»ä½•åˆ°è¨ªæ™‚æ®µã€‚";
    return;
  }

  step3Summary.textContent =
    `æœ¬æ¬¡å…±é ç´„ ${total} æ¬¡ï¼šæ—© ${countMorning}ã€åˆ ${countAfternoon}ã€æ™š ${countEvening}ã€æ·±å¤œ ${countLate}`;
}

/* ============================================================
/* Step 4ï¼šæœå‹™é¡å‹é¸æ“‡ */
const serviceTypeCards = document.querySelectorAll('#stepServiceType .option-card');
const serviceTypeSummary = document.getElementById("serviceTypeSummary");

serviceTypeCards.forEach(card => {
  card.addEventListener("click", () => {

    // ç§»é™¤å…¶ä»–å¡ç‰‡çš„ active æ¨£å¼
    serviceTypeCards.forEach(c => c.classList.remove("active"));

    // åŠ ä¸Šç›®å‰é¸åˆ°çš„å¡ç‰‡
    card.classList.add("active");

    // å–å¾—è³‡æ–™
    serviceType = card.dataset.service;

    // å¡«å…¥ä¸‹æ–¹æç¤ºæ¡†
    serviceTypeSummary.textContent = `æ‚¨é¸æ“‡ï¼š${serviceType}`;
  });
});



/* ============================================================
   Step 5ï¼šæœå‹™æ–¹æ¡ˆï¼ˆ30 / 45 / 60ï¼‰
============================================================ */

const planCards = document.querySelectorAll('#stepPlan .option-card');
const planSummary = document.getElementById("planSummary");

planCards.forEach(card => {
  card.addEventListener("click", () => {
    planCards.forEach(c => c.classList.remove("active"));
    card.classList.add("active");

    selectedPlan = card.dataset.plan;
    selectedPlanPrice = Number(card.dataset.price);

    planSummary.textContent = `æ‚¨é¸æ“‡ ${selectedPlan} åˆ†é˜ï¼ˆNT.${selectedPlanPrice} / æ¬¡ï¼‰`;
  });
});


/* ============================================================
   Step 6ï¼šæ¯›å­©æ•¸é‡ï¼ˆåŠ åƒ¹é‚è¼¯ï¼‰
============================================================ */

const dogCountInput = document.getElementById("dogCount");
const catCountInput = document.getElementById("catCount");
const multiPetSummary = document.getElementById("multiPetSummary");

let dogExtraFeePerVisit = 0;
let catRequireEval = false;

dogCountInput.addEventListener("input", updateMultiPet);
catCountInput.addEventListener("input", updateMultiPet);

function updateMultiPet() {
  dogCountValue = Number(dogCountInput.value);
  catCountValue = Number(catCountInput.value);

  /* é›ç‹—æ•£æ­¥åŠ åƒ¹ï¼šç¬¬äºŒéš»èµ· +100 / è¨ªè¦– */
  if (serviceType === "é›ç‹—æ•£æ­¥") {
    dogExtraFeePerVisit = Math.max(dogCountValue - 1, 0) * 100;
  } else {
    dogExtraFeePerVisit = 0;
  }

  /* è²“å’ªï¼šç¬¬ä¸‰éš»ä»¥ä¸Š â†’ ä¸è‡ªå‹•åŠ åƒ¹ï¼Œä½†é¡¯ç¤ºéœ€ Pinyu è©•ä¼° */
  catRequireEval = catCountValue >= 3;

  let text = `ç‹—ç‹—åŠ åƒ¹ï¼š+${dogExtraFeePerVisit} å…ƒ / è¨ªè¦–<br>`;

  if (catRequireEval) {
    text += `è²“å’ªï¼šç¬¬ä¸‰éš»ä»¥ä¸Šç”± Pinyu è©•ä¼°æ˜¯å¦åŠ åƒ¹ï¼ˆæœªè‡ªå‹•è¨ˆç®—ï¼‰`;
  } else {
    text += `è²“å’ªï¼šæœªé”åŠ åƒ¹æ¢ä»¶`;
  }

  multiPetSummary.innerHTML = text;
}


/* ============================================================
   Step 7ï¼šåŠ è³¼é …ç›®
============================================================ */

const addonInputs = document.querySelectorAll('#stepAddons input[type="checkbox"]');
const addonSummary = document.getElementById("addonSummary");

addonInputs.forEach(box => {
  box.addEventListener("change", () => {
    const key = box.dataset.addon;
    const price = Number(box.dataset.price);

    if (box.checked) {
      addons[key] = price;
    } else {
      delete addons[key];
    }

    const text = Object.entries(addons)
      .map(([k, p]) => `${k} (+${p})`)
      .join(", ");

    addonSummary.textContent = text || "å°šæœªé¸æ“‡åŠ è³¼é …ç›®ã€‚";
  });
});


/* ============================================================
   Step 8ï¼šè©¦ç®—å ±åƒ¹
============================================================ */

const quoteRange = document.getElementById("quoteRange");
const quoteServiceType = document.getElementById("quoteServiceType");
const quoteTotal = document.getElementById("quoteTotal");
const quoteDateRangeText = document.getElementById("quoteDateRangeText");
const quoteDuration = document.getElementById("quoteDuration");
const quoteVisitCount = document.getElementById("quoteVisitCount");
const quoteUnitPriceText = document.getElementById("quoteUnitPriceText");
const quoteFareText = document.getElementById("quoteFareText");
const quoteMultiPet = document.getElementById("quoteMultiPet");
const quoteAddons = document.getElementById("quoteAddons");
const quoteSubtotal = document.getElementById("quoteSubtotal");
const quoteDepositText = document.getElementById("quoteDepositText");
const quoteDebugBox = document.getElementById("quoteDebugBox");

function calculatePrice() {

  const visits = buildVisitArray(); // æ¯è¨ªè¦–çš„æ—¥æœŸï¼‹æ™‚æ®µ
  const visitCount = visits.length;

  // â‘  åŸºæœ¬æœå‹™è²»
  const serviceTotal = selectedPlanPrice * visitCount;

  // â‘¡ è»Šé¦¬è²»
  const fareTotal = farePerVisit * visitCount;

  // â‘¢ å¤šå¯µå®¶åº­åŠ åƒ¹ï¼ˆé›ç‹—æ•£æ­¥ç¬¬äºŒéš»èµ·ï¼‰
  const dogExtraTotal = dogExtraFeePerVisit * visitCount;

  // â‘£ åŠ è³¼é …ç›®ï¼ˆå›ºå®šæ¯æ¬¡æœå‹™æ”¶è²»ï¼‰
  const addonTotal = Object.values(addons)
    .reduce((sum, p) => sum + p * visitCount, 0);

  // ç¸½è¨ˆ
  const total = serviceTotal + fareTotal + dogExtraTotal + addonTotal;

  /* ====== UI é¡¯ç¤º ====== */

  quoteRange.textContent = `${startInput.value} ï½ ${endInput.value}`;
  quoteServiceType.textContent = `${serviceType}ï¼ˆ${selectedPlan} åˆ†é˜ï¼‰`;
  quoteTotal.textContent = `${total.toLocaleString("zh-TW")} å…ƒ`;

  const days = getDateRangeArray(startDate, endDate).length;
  quoteDateRangeText.textContent = `${days} å¤©`;

  quoteDuration.textContent = `${selectedPlan} åˆ†é˜`;
  quoteVisitCount.textContent = `${visitCount} æ¬¡`;

  quoteUnitPriceText.textContent =
    `${selectedPlanPrice} å…ƒ Ã— ${visitCount} æ¬¡ = ${serviceTotal}`;

  quoteFareText.textContent =
    `${farePerVisit} å…ƒ Ã— ${visitCount} æ¬¡ = ${fareTotal}`;

  quoteMultiPet.textContent = `
    ç‹—ï¼š+${dogExtraFeePerVisit} Ã— ${visitCount} = ${dogExtraTotal}
    ${catRequireEval ? "ï½œè²“ï¼šç¬¬ä¸‰éš»éœ€ Pinyu è©•ä¼°" : ""}
  `;

  quoteAddons.textContent = addonTotal
    ? `åŠ è³¼åˆè¨ˆï¼š${addonTotal}`
    : "ç„¡";

  quoteSubtotal.textContent = `è©¦ç®—ç¸½é¡ï¼š${total.toLocaleString("zh-TW")} å…ƒ`;

  quoteDepositText.textContent = depositText;

  quoteDebugBox.textContent =
    "DEBUGï¼ˆé€å‡º payloadï¼‰\n" +
    JSON.stringify(buildPayload(), null, 2);
}


/* ============================================================
   æ‰“åŒ… Payloadï¼ˆé€åˆ° Apps Scriptï¼‰
============================================================ */

function buildVisitArray() {
  const visits = [];

  Object.entries(schedule).forEach(([dateKey, set]) => {
    set.forEach(slot => {
      visits.push({
        date: dateKey,
        slot: slot,
      });
    });
  });

  return visits;
}

function buildPayload() {
  return {
    familyId,
    isNewCustomer,

    serviceType,
    planMinutes: selectedPlan,
    planPrice: selectedPlanPrice,

    dogCount: dogCountValue,
    catCount: catCountValue,
    dogExtraPerVisit: dogExtraFeePerVisit,
    catRequireEval,

    addons,

    startDate: startInput.value,
    endDate: endInput.value,
    farePerVisit,

    visits: buildVisitArray(),

    depositText,
  };
}


/* ============================================================
   Step æŒ‰éˆ•ï¼šä¸Šä¸€é  / ä¸‹ä¸€é 
============================================================ */

nextBtn.addEventListener("click", () => {
  if (currentStep === 1) {
    if (isNewCustomer && !hasValidDistance) {
      // æ–°å®¢å¿…å¡«ï¼šè‡³å°‘è¼¸å…¥ä¸€æ¬¡åˆæ³•çš„å…¬é‡Œæ•¸
      alert("è«‹å…ˆè¼¸å…¥è·é›¢ä»¥è©¦ç®—è»Šé¦¬è²»");
      return;
    }
    currentStep = 2;
}
 else if (currentStep === 2) {
    if (!startDate || !endDate) {
      alert("è«‹å…ˆé¸æ“‡æ—¥æœŸå€é–“");
      return;
    }
    if (!selectedTemplate) {
      alert("è«‹å…ˆé¸æ“‡é è¨­é »ç‡");
      return;
    }

    applyTemplateToSchedule(selectedTemplate);
    renderDayList();
    currentStep = 3;

  } else if (currentStep === 3) {
    if (buildVisitArray().length === 0) {
      alert("è«‹è‡³å°‘å‹¾é¸ä¸€å€‹æ™‚æ®µ");
      return;
    }
    currentStep = 4;

  } else if (currentStep === 4) {
    if (!serviceType) {
      alert("è«‹é¸æ“‡æœå‹™é¡å‹");
      return;
    }
    currentStep = 5;

  } else if (currentStep === 5) {
    if (!selectedPlan) {
      alert("è«‹é¸æ“‡æœå‹™æ–¹æ¡ˆ");
      return;
    }
    currentStep = 6;

  } else if (currentStep === 6) {
    currentStep = 7;

  } else if (currentStep === 7) {
    calculatePrice();
    currentStep = 8;

  } else if (currentStep === 8) {
    const payload = buildPayload();
    alert("å°‡é€å‡ºé ç´„éœ€æ±‚ï¼š\n" + JSON.stringify(payload, null, 2));

    // ä½ ä¹‹å¾Œå¯æ‰“é–‹é€™æ®µï¼ŒæŠŠè³‡æ–™é€åˆ° Apps Script
    /*
    fetch(WEB_APP_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        action: "createBooking",
        data: payload,
      }),
    }).then(r => r.json()).then(res => {
      alert("é ç´„å·²é€å‡º");
    });
    */
  }

  updateStepUI();
});


prevBtn.addEventListener("click", () => {
  if (currentStep > 1) {
    currentStep--;
    updateStepUI();
  }
});

    
  </script>

</body>
</html>
