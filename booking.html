  <!-- æ”¾åœ¨ </head> å‰æˆ–ä¸€é–‹å§‹ -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  ...
  <script>
    const ADMIN_UIDS = [
      "U9b0f1fd6029a58ff6c0fc06cf85da8dd"  // ä½ çš„ LINE userId
    ];

    async function checkAdmin() {
      try {
        await liff.init({ liffId: "2008600362-O4V8Aq10" });

        // å¦‚æœæ²’ç™»å…¥ï¼Œå…ˆè«‹ä»–ç™»å…¥
        if (!liff.isLoggedIn()) {
          liff.login();
          return false;
        }

        const profile = await liff.getProfile();
        console.log("current userId:", profile.userId);

        if (!ADMIN_UIDS.includes(profile.userId)) {
          document.body.innerHTML = `
            <div style="padding:24px;font-size:16px;line-height:1.6;">
              æ­¤é ç´„é æ­£åœ¨å…§éƒ¨æ¸¬è©¦ä¸­ï¼Œå°šæœªå°å¤–é–‹æ”¾ã€‚<br/>
              å¦‚æœ‰é ç´„éœ€æ±‚ï¼Œè«‹ç›´æ¥ç§è¨Šå¿«æ¨‚å°ç‹— pinyu ğŸ¾
            </div>
          `;
          return false;
        }
        return true;
      } catch (e) {
        console.error(e);
        document.body.innerHTML = `
          <div style="padding:24px;font-size:16px;line-height:1.6;">
            ç„¡æ³•è¼‰å…¥é ç´„é é¢ï¼Œè«‹ç¨å¾Œå†è©¦æˆ–ç§è¨Šä¿å§†ã€‚<br/>
          </div>
        `;
        return false;
      }
    }

    // ===== å‡è³‡æ–™ï¼šä¹‹å¾Œå¯ä»¥æ›æˆå‘¼å« GAS API =====
    const mockAvailability = {
      '2025-12-19': '15:00',
      '2025-12-23': '18:30',
      '2025-12-24': '20:00'
    };

    let current = new Date(); // ä»Šå¤©
    current.setDate(1);       // ç§»åˆ°ç•¶æœˆ1è™Ÿ
    let selectedDate = null;
    let selectedTime = null;

    function formatDateKey(d) {
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const day = String(d.getDate()).padStart(2,'0');
      return `${y}-${m}-${day}`;
    }

    function initCalendar() {
      const monthLabel = document.getElementById('monthLabel');
      const daysGrid = document.getElementById('daysGrid');
      const timesTitle = document.getElementById('timesTitle');
      const timeBtn = document.getElementById('timeBtn');
      const nextBtn = document.getElementById('nextBtn');

      function renderCalendar() {
        const y = current.getFullYear();
        const m = current.getMonth();
        monthLabel.textContent = `${y} å¹´ ${m+1} æœˆ`;

        daysGrid.innerHTML = '';
        const firstDay = new Date(y, m, 1);
        const firstWeekday = (firstDay.getDay() + 6) % 7;
        const daysInMonth = new Date(y, m+1, 0).getDate();

        for (let i = 0; i < firstWeekday; i++) {
          const cell = document.createElement('div');
          cell.className = 'day-cell';
          daysGrid.appendChild(cell);
        }

        for (let d = 1; d <= daysInMonth; d++) {
          const cell = document.createElement('div');
          cell.className = 'day-cell';
          const dateObj = new Date(y, m, d);
          const key = formatDateKey(dateObj);
          const hasSlot = !!mockAvailability[key];

          if (!hasSlot) {
            cell.classList.add('day-disabled');
          } else {
            cell.classList.add('day-available');
          }

          cell.textContent = d;

          if (selectedDate &&
              dateObj.toDateString() === selectedDate.toDateString()) {
            cell.classList.add('day-selected');
          }

          if (hasSlot) {
            cell.addEventListener('click', () => {
              selectedDate = dateObj;
              selectedTime = mockAvailability[key];
              updateTimeSection();
              renderCalendar();
            });
          }

          daysGrid.appendChild(cell);
        }
      }

      function updateTimeSection() {
        if (!selectedDate) {
          timesTitle.textContent = 'è«‹å…ˆé¸æ“‡æ—¥æœŸ';
          timeBtn.textContent = '--:--';
          timeBtn.disabled = true;
          timeBtn.classList.add('disabled');
          nextBtn.disabled = true;
          return;
        }
        const key = formatDateKey(selectedDate);
        const t = mockAvailability[key];
        timesTitle.textContent = `${selectedDate.getMonth()+1}/${selectedDate.getDate()} å¯é ç´„æ™‚é–“`;
        timeBtn.textContent = t || 'å·²é¡æ»¿';
        const canBook = !!t;
        timeBtn.disabled = !canBook;
        nextBtn.disabled = !canBook;
        if (canBook) {
          timeBtn.classList.remove('disabled');
        } else {
          timeBtn.classList.add('disabled');
        }
      }

      document.getElementById('prevMonth').addEventListener('click', () => {
        current.setMonth(current.getMonth() - 1);
        renderCalendar();
        updateTimeSection();
      });
      document.getElementById('nextMonth').addEventListener('click', () => {
        current.setMonth(current.getMonth() + 1);
        renderCalendar();
        updateTimeSection();
      });

      nextBtn.addEventListener('click', () => {
        if (!selectedDate || !selectedTime) return;
        alert(`æ¥ä¸‹ä¾†é€²å…¥å‚™è¨»é ï¼š\næ—¥æœŸï¼š${formatDateKey(selectedDate)}\næ™‚é–“ï¼š${selectedTime}`);
      });

      renderCalendar();
      updateTimeSection();
    }

    // ç­‰ DOM è¼‰å…¥å¾Œå†æª¢æŸ¥èº«åˆ†ï¼‹åˆå§‹åŒ–ç•«é¢
    document.addEventListener('DOMContentLoaded', async () => {
      const ok = await checkAdmin();
      if (!ok) return; // ä¸æ˜¯ç®¡ç†å“¡ï¼Œç›´æ¥çµæŸ
      initCalendar();  // åªæœ‰ç®¡ç†å“¡æ‰æœƒè·‘åˆ°é€™è£¡
    });
  </script>
</body>
</html>
