<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>é ç´„æ™‚é–“é¸æ“‡</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f7fb;
      color: #333;
    }
    .page {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: #ffffff;
    }
    header {
      padding: 12px 16px;
      font-size: 16px;
      font-weight: 600;
      text-align: center;
      border-bottom: 1px solid #e0ebf7;
      color: #144a7e;
    }
    .calendar-wrapper {
      padding: 8px 16px 0;
    }
    .month-row {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 12px;
      margin-bottom: 4px;
    }
    .month-btn {
      border: none;
      background: transparent;
      font-size: 18px;
      cursor: pointer;
      padding: 4px 8px;
      color: #48a2e8;
    }
    .month-label {
      font-size: 15px;
      font-weight: 500;
      color: #144a7e;
    }
    .weekday-row,
    .days-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
    }
    .weekday-row {
      font-size: 12px;
      color: #8fa0ba;
      padding: 4px 0;
    }
    .day-cell {
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      cursor: pointer;
      position: relative;
    }
    .day-disabled {
      color: #c8ceda;
      cursor: default;
    }
    .day-available {
      font-weight: 600;
      color: #123456;
    }
    .day-selected::after {
      content: "";
      position: absolute;
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: #e4f2ff; /* å“ç‰Œè—çš„æ·¡åº• */
      z-index: -1;
    }

    .times-card {
      margin: 12px 16px;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid #cfe3fb;
      background: #f5f9ff;
    }
    .times-title {
      font-size: 13px;
      color: #4a6487;
      margin-bottom: 8px;
    }
    .time-btn {
      width: 100%;
      padding: 12px 0;
      border-radius: 12px;
      border: 1px solid #48a2e8;
      background: #ffffff;
      color: #1764b3;
      font-size: 16px;
      font-weight: 600;
      text-align: center;
      cursor: pointer;
    }
    .time-btn.disabled {
      opacity: 0.4;
      cursor: default;
    }

    .bottom-bar {
      margin-top: auto;
      padding: 12px 16px 24px;
      border-top: 1px solid #e0ebf7;
      background: #ffffff;
    }
    .primary-btn {
      width: 100%;
      border-radius: 999px;
      border: none;
      padding: 12px 0;
      font-size: 15px;
      font-weight: 600;
      color: #ffffff;
      background: #48a2e8;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(72, 162, 232, 0.25);
    }
    .primary-btn:disabled {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
    }
    .sub-text {
      font-size: 11px;
      color: #8fa0ba;
      margin-top: 4px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>é¸æ“‡é ç´„æ™‚é–“</header>

    <div class="calendar-wrapper">
      <div class="month-row">
        <button class="month-btn" id="prevMonth">&lt;</button>
        <div class="month-label" id="monthLabel"></div>
        <button class="month-btn" id="nextMonth">&gt;</button>
      </div>
      <div class="weekday-row">
        <div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div><div>å››</div><div>äº”</div><div>å…­</div><div>æ—¥</div>
      </div>
      <div class="days-grid" id="daysGrid"></div>
    </div>

    <div class="times-card">
      <div class="times-title" id="timesTitle">è«‹å…ˆé¸æ“‡æ—¥æœŸ</div>
      <button class="time-btn disabled" id="timeBtn" disabled>--:--</button>
    </div>

    <div class="bottom-bar">
      <button class="primary-btn" id="nextBtn" disabled>å¡«å¯«é ç´„å‚™è¨» âœ</button>
      <div class="sub-text">æœƒå…ˆå»ºç«‹é ç´„éœ€æ±‚ï¼Œä¿å§†ç¢ºèªå¾Œå†èˆ‡æ‚¨æ•²å®šæ™‚é–“ ğŸ¾</div>
    </div>
  </div>

  <script>
    // ===== å‡è³‡æ–™ï¼šé€™è£¡æš«æ™‚å…ˆå¯«æ­»ï¼Œå¯ä¹‹å¾Œæ”¹æˆ call Apps Script API =====
    // key: 'YYYY-MM-DD' â†’ value: å¯é ç´„æ™‚é–“å­—ä¸²
    const mockAvailability = {
      '2025-12-19': '15:00',
      '2025-12-23': '18:30',
      '2025-12-24': '20:00'
    };

    const monthLabel = document.getElementById('monthLabel');
    const daysGrid = document.getElementById('daysGrid');
    const timesTitle = document.getElementById('timesTitle');
    const timeBtn = document.getElementById('timeBtn');
    const nextBtn = document.getElementById('nextBtn');

    let current = new Date(); // ä»Šå¤©
    current.setDate(1); // ç§»åˆ°ç•¶æœˆ1è™Ÿ
    let selectedDate = null;  // è¢«é¸åˆ°çš„ Date ç‰©ä»¶
    let selectedTime = null;

    function formatDateKey(d) {
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const day = String(d.getDate()).padStart(2,'0');
      return `${y}-${m}-${day}`;
    }

    function renderCalendar() {
      const y = current.getFullYear();
      const m = current.getMonth(); // 0-based
      monthLabel.textContent = `${y} å¹´ ${m+1} æœˆ`;

      daysGrid.innerHTML = '';
      const firstDay = new Date(y, m, 1);
      const firstWeekday = (firstDay.getDay() + 6) % 7; // è½‰æˆ 0=ä¸€ ... 6=æ—¥

      const daysInMonth = new Date(y, m+1, 0).getDate();

      // å‰é¢ç©ºæ ¼
      for (let i = 0; i < firstWeekday; i++) {
        const cell = document.createElement('div');
        cell.className = 'day-cell';
        daysGrid.appendChild(cell);
      }

      // æ¯ä¸€å¤©
      for (let d = 1; d <= daysInMonth; d++) {
        const cell = document.createElement('div');
        cell.className = 'day-cell';
        const dateObj = new Date(y, m, d);
        const key = formatDateKey(dateObj);

        const hasSlot = !!mockAvailability[key];

        if (!hasSlot) {
          cell.classList.add('day-disabled');
        } else {
          cell.classList.add('day-available');
        }

        cell.textContent = d;

        if (selectedDate &&
            dateObj.toDateString() === selectedDate.toDateString()) {
          cell.classList.add('day-selected');
        }

        if (hasSlot) {
          cell.addEventListener('click', () => {
            selectedDate = dateObj;
            selectedTime = mockAvailability[key];
            updateTimeSection();
            renderCalendar(); // é‡æ–°ç•«ä¸€æ¬¡å¥— selected æ¨£å¼
          });
        }

        daysGrid.appendChild(cell);
      }
    }

    function updateTimeSection() {
      if (!selectedDate) {
        timesTitle.textContent = 'è«‹å…ˆé¸æ“‡æ—¥æœŸ';
        timeBtn.textContent = '--:--';
        timeBtn.disabled = true;
        timeBtn.classList.add('disabled');
        nextBtn.disabled = true;
        return;
      }
      const key = formatDateKey(selectedDate);
      const t = mockAvailability[key];
      timesTitle.textContent = `${selectedDate.getMonth()+1}/${selectedDate.getDate()} å¯é ç´„æ™‚é–“`;
      timeBtn.textContent = t || 'å·²é¡æ»¿';
      const canBook = !!t;
      timeBtn.disabled = !canBook;
      nextBtn.disabled = !canBook;
      if (canBook) {
        timeBtn.classList.remove('disabled');
      } else {
        timeBtn.classList.add('disabled');
      }
    }

    document.getElementById('prevMonth').addEventListener('click', () => {
      current.setMonth(current.getMonth() - 1);
      renderCalendar();
      updateTimeSection();
    });
    document.getElementById('nextMonth').addEventListener('click', () => {
      current.setMonth(current.getMonth() + 1);
      renderCalendar();
      updateTimeSection();
    });

    // ä¹‹å¾Œé»ã€Œå¡«å¯«é ç´„å‚™è¨»ã€å¯ä»¥è·³åˆ°ç¬¬äºŒé  / æˆ–é¡¯ç¤ºå‚™è¨»è¡¨å–®
    nextBtn.addEventListener('click', () => {
      if (!selectedDate || !selectedTime) return;
      alert(`æ¥ä¸‹ä¾†é€²å…¥å‚™è¨»é ï¼š\næ—¥æœŸï¼š${formatDateKey(selectedDate)}\næ™‚é–“ï¼š${selectedTime}`);
      // TODOï¼šé€™è£¡ä¹‹å¾Œå¯ä»¥æ”¹æˆï¼š
      // 1ï¼‰location.href æ›åˆ°ã€Œå‚™è¨»å¡«å¯«ã€çš„ç¬¬äºŒå€‹ LIFF é é¢ï¼Œæˆ–
      // 2ï¼‰åœ¨åŒä¸€é ä¸‹æ–¹æ‰“é–‹ä¸€å€‹è¡¨å–®ï¼ŒæŠŠæ—¥æœŸæ™‚é–“ä¸€èµ·é€å› Apps Script
    });

    renderCalendar();
    updateTimeSection();
  </script>
</body>
</html>
