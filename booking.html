<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å¯µç‰©ä¿å§†é ç´„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f7fb;
    }
    .page {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 12px 16px 24px;
      box-sizing: border-box;
    }
    h1 {
      font-size: 20px;
      margin: 8px 0 16px;
      text-align: center;
      letter-spacing: 2px;
    }
    .card {
      background: #ffffff;
      border-radius: 12px;
      padding: 12px 14px;
      margin-bottom: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .card-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 6px;
    }
    .field {
      margin-bottom: 8px;
    }
    .field-label {
      font-size: 13px;
      margin-bottom: 2px;
      color: #555;
    }
    .hint {
      font-size: 11px;
      color: #888;
      margin-bottom: 4px;
    }
    input[type="date"],
    input[type="time"],
    input[type="text"],
    select,
    textarea {
      width: 100%;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #d0d4e0;
      box-sizing: border-box;
      font-size: 14px;
    }
    textarea {
      min-height: 70px;
      resize: vertical;
    }
    .inline-row {
      display: flex;
      gap: 8px;
    }
    .inline-row > div {
      flex: 1;
    }
    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }
    .chip {
      border-radius: 999px;
      padding: 4px 10px;
      border: 1px solid #d0d4e0;
      font-size: 13px;
      cursor: pointer;
      user-select: none;
    }
    .chip.selected {
      background: #48a2e8;
      color: white;
      border-color: #48a2e8;
    }
    .radio-group,
    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 13px;
    }
    .radio-item,
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .btn-submit {
      width: 100%;
      border: none;
      border-radius: 999px;
      padding: 10px 0;
      font-size: 15px;
      font-weight: 600;
      color: #fff;
      background: #48a2e8;
      margin-top: 8px;
      cursor: pointer;
    }
    .btn-submit:disabled {
      opacity: 0.5;
      cursor: default;
    }
    .footer-note {
      font-size: 11px;
      color: #999;
      text-align: center;
      margin-top: 6px;
    }
    .error {
      color: #c62828;
      font-size: 12px;
      margin-top: 4px;
    }
  </style>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <div class="page">
    <h1>é ç´„åˆ°åºœç…§é¡§</h1>

    <!-- æ—¥æœŸèˆ‡é »ç‡ -->
    <div class="card">
      <div class="card-title">1ï½œæœå‹™æ—¥æœŸèˆ‡é »ç‡</div>
      <div class="field inline-row">
        <div>
          <div class="field-label">é–‹å§‹æ—¥æœŸ</div>
          <input type="date" id="startDate" />
        </div>
        <div>
          <div class="field-label">çµæŸæ—¥æœŸ</div>
          <input type="date" id="endDate" />
        </div>
      </div>
      <div class="field">
        <div class="field-label">æœå‹™é »ç‡</div>
        <div class="radio-group" id="frequencyGroup">
          <label class="radio-item">
            <input type="radio" name="frequency" value="ä¸€å¤©ä¸€æ¬¡" checked />
            <span>ä¸€å¤©ä¸€æ¬¡</span>
          </label>
          <label class="radio-item">
            <input type="radio" name="frequency" value="æ—©æ™šå„ä¸€æ¬¡" />
            <span>æ—©æ™šå„ä¸€æ¬¡</span>
          </label>
          <label class="radio-item">
            <input type="radio" name="frequency" value="æ—©ä¸­æ™šå„ä¸€æ¬¡" />
            <span>æ—©ä¸­æ™šå„ä¸€æ¬¡</span>
          </label>
          <label class="radio-item">
            <input type="radio" name="frequency" value="å…©å¤©ä¸€æ¬¡" />
            <span>å…©å¤©ä¸€æ¬¡</span>
          </label>
          <label class="radio-item">
            <input type="radio" name="frequency" value="ä¸‰å¤©ä¸€æ¬¡" />
            <span>ä¸‰å¤©ä¸€æ¬¡</span>
          </label>
          <label class="radio-item">
            <input type="radio" name="frequency" value="å…¶ä»–" />
            <span>å…¶ä»–ï¼ˆå‚™è¨»èªªæ˜ï¼‰</span>
          </label>
        </div>
      </div>
      <div class="field">
        <div class="field-label">æœå‹™å€æ®µ</div>
        <div class="hint">å¦‚æœé¸ã€Œä¸€å¤©ä¸€æ¬¡ã€å»ºè­°åªå‹¾ä¸€å€‹ï¼›ã€Œæ—©æ™šå„ä¸€æ¬¡ã€å°‡è‡ªå‹•å¸¶å…¥æ—©ï¼‹æ™šã€‚</div>
        <div class="chips" id="sectionChips">
          <div class="chip" data-value="æ—©ä¸Š">æ—©ä¸Š</div>
          <div class="chip" data-value="ä¸‹åˆ">ä¸‹åˆ</div>
          <div class="chip" data-value="æ™šä¸Š">æ™šä¸Š</div>
          <div class="chip" data-value="æ·±å¤œ">æ·±å¤œ</div>
        </div>
      </div>
    </div>

    <!-- æ™‚é–“å½ˆæ€§ -->
    <div class="card">
      <div class="card-title">2ï½œæ™‚é–“å½ˆæ€§</div>
      <div class="field">
        <div class="radio-group" id="timeFlexGroup">
          <label class="radio-item">
            <input type="radio" name="timeFlex" value="flex" checked />
            <span>æ™‚é–“å½ˆæ€§ï¼Œå€æ®µå…§çš†å¯ï¼Œç”±ä¿å§†å®‰æ’</span>
          </label>
          <label class="radio-item">
            <input type="radio" name="timeFlex" value="approx" />
            <span>å¸Œæœ›å¤§ç´„æ™‚é–“ï¼ˆä¾‹å¦‚ 18:00 å·¦å³ï¼‰</span>
          </label>
          <label class="radio-item">
            <input type="radio" name="timeFlex" value="fixed" />
            <span>éœ€ç›¡é‡å›ºå®šæ™‚é–“ï¼ˆé¤µè—¥ç­‰ï¼‰</span>
          </label>
        </div>
      </div>
      <div class="field" id="timeField" style="display:none;">
        <div class="field-label">å¸Œæœ›æ™‚é–“ï¼ˆå¯ç´„ç•¥ï¼‰</div>
        <input type="time" id="specifiedTime" />
      </div>
      <div class="hint">å¯¦éš›åˆ°è¨ªæ™‚é–“æœƒä¾ç•¶æ—¥è·¯ç·šå®‰æ’ï¼Œæœå‹™å‰æœƒå†èˆ‡æ‚¨ç¢ºèªå”· ğŸ¾</div>
    </div>

    <!-- æ¯›å­©èˆ‡æœå‹™å…§å®¹ -->
    <div class="card">
      <div class="card-title">3ï½œæ¯›å­©èˆ‡æœå‹™å…§å®¹</div>
      <div class="field">
        <div class="field-label">æ¯›å­©å§“å</div>
        <input type="text" id="petNames" placeholder="ä¾‹å¦‚ï¼šè¥ªè¥ªã€å°é»‘ï¼ˆå¤šéš»ç”¨é “è™Ÿæˆ–é€—è™Ÿåˆ†éš”ï¼‰" />
      </div>
      <div class="field">
        <div class="field-label">æœå‹™é¡åˆ¥</div>
        <select id="serviceCategory">
          <option value="åˆ°åºœç…§é¡§" selected>åˆ°åºœç…§é¡§</option>
          <option value="åˆ°åºœæ•£æ­¥">åˆ°åºœæ•£æ­¥</option>
          <option value="å…¶ä»–">å…¶ä»–ï¼ˆå‚™è¨»èªªæ˜ï¼‰</option>
        </select>
      </div>
      <div class="field">
        <div class="field-label">æœå‹™æ–¹æ¡ˆ</div>
        <select id="servicePlan">
          <option value="30åˆ†">30 åˆ†</option>
          <option value="45åˆ†">45 åˆ†</option>
          <option value="60åˆ†" selected>60 åˆ†</option>
          <option value="90åˆ†">90 åˆ†</option>
        </select>
      </div>
      <div class="field">
        <div class="field-label">å…¶ä»–éœ€æ±‚ï¼å‚™è¨»</div>
        <textarea id="note" placeholder="ä¾‹å¦‚ï¼šæœ‰é¤µè—¥éœ€æ±‚ã€æ€•ç”Ÿã€å–œæ­¡é€—è²“æ£’ã€å°é™Œç”Ÿäººæ•æ„Ÿâ€¦"></textarea>
      </div>
    </div>

    <button class="btn-submit" id="btnSubmit">é€å‡ºé ç´„</button>
    <div class="footer-note">é€å‡ºå¾Œç³»çµ±æœƒå…ˆå»ºç«‹ã€Œé ç´„éœ€æ±‚å–®ã€ï¼Œä¿å§†ç¢ºèªå¾Œå†èˆ‡æ‚¨å›è¦†ç¢ºå®šæ™‚æ®µã€‚</div>
    <div class="error" id="errorBox" style="display:none;"></div>
  </div>

  <script>
    // ====== LIFF åˆå§‹åŒ– ======
    const LIFF_ID = "YOUR_LIFF_ID"; // â† æ›æˆä½ çš„ LIFF ID

    async function initLiff() {
      await liff.init({ liffId: LIFF_ID });
      if (!liff.isLoggedIn()) {
        liff.login();
        return;
      }
    }

    // ====== UI è¡Œç‚º ======
    function setupSectionChips() {
      const chips = document.querySelectorAll("#sectionChips .chip");
      chips.forEach(chip => {
        chip.addEventListener("click", () => {
          chip.classList.toggle("selected");
        });
      });
    }

    function setupTimeFlex() {
      const group = document.getElementById("timeFlexGroup");
      const timeField = document.getElementById("timeField");
      group.addEventListener("change", () => {
        const value = group.querySelector("input[name='timeFlex']:checked").value;
        if (value === "approx" || value === "fixed") {
          timeField.style.display = "block";
        } else {
          timeField.style.display = "none";
        }
      });
    }

    function getSelectedSections() {
      const selected = [];
      document.querySelectorAll("#sectionChips .chip.selected").forEach(chip => {
        selected.push(chip.dataset.value);
      });
      return selected;
    }

    function getSelectedRadio(name) {
      const el = document.querySelector(`input[name="${name}"]:checked`);
      return el ? el.value : "";
    }

    function showError(msg) {
      const box = document.getElementById("errorBox");
      box.textContent = msg;
      box.style.display = msg ? "block" : "none";
    }

    async function submitForm() {
      showError("");
      const btn = document.getElementById("btnSubmit");
      btn.disabled = true;

      const startDate = document.getElementById("startDate").value;
      const endDate = document.getElementById("endDate").value || startDate;
      const frequency = getSelectedRadio("frequency");
      const sections = getSelectedSections();
      const timeFlex = getSelectedRadio("timeFlex");
      const specifiedTime = document.getElementById("specifiedTime").value || "";
      const petNames = document.getElementById("petNames").value.trim();
      const serviceCategory = document.getElementById("serviceCategory").value;
      const servicePlan = document.getElementById("servicePlan").value;
      const note = document.getElementById("note").value.trim();

      // ç°¡å–®é©—è­‰
      if (!startDate) {
        showError("è«‹é¸æ“‡é–‹å§‹æ—¥æœŸ");
        btn.disabled = false;
        return;
      }
      if (sections.length === 0) {
        showError("è«‹è‡³å°‘é¸æ“‡ä¸€å€‹æœå‹™å€æ®µ");
        btn.disabled = false;
        return;
      }
      if (!petNames) {
        showError("è«‹å¡«å¯«æ¯›å­©å§“å");
        btn.disabled = false;
        return;
      }
      if ((timeFlex === "approx" || timeFlex === "fixed") && !specifiedTime) {
        showError("è«‹å¡«å¯«å¸Œæœ›çš„æ™‚é–“");
        btn.disabled = false;
        return;
      }

      // å–å¾— LINE ä½¿ç”¨è€…è³‡è¨Š
      let lineUserId = "";
      let lineDisplayName = "";
      try {
        const profile = await liff.getProfile();
        lineUserId = profile.userId || "";
        lineDisplayName = profile.displayName || "";
      } catch (e) {
        // è‹¥å–ä¸åˆ°ä¹Ÿæ²’é—œä¿‚ï¼Œå¾Œç«¯å¯ç”¨ idToken å†æŸ¥
      }

      const payload = {
        startDate,
        endDate,
        frequency,
        sections,
        timeFlex,
        specifiedTime,
        pets: petNames.split(/[,ã€ï¼Œ]/).map(s => s.trim()).filter(Boolean),
        serviceCategory,
        servicePlan,
        note,
        lineUserId,
        lineDisplayName,
        source: "LIFF-Booking"
      };

      try {
        const res = await fetch("YOUR_APPS_SCRIPT_WEBAPP_URL", { // â† æ›æˆä½ çš„ Apps Script Web App URL
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        if (!res.ok) throw new Error("network");

        const data = await res.json().catch(() => ({}));

        alert("å·²é€å‡ºé ç´„ï¼Œæ„Ÿè¬æ‚¨çš„å¡«å¯« ğŸ’›\n\nä¹‹å¾Œæœƒå†èˆ‡æ‚¨ç¢ºèªå¯¦éš›åˆ°è¨ªæ™‚é–“ã€‚");

        // å¦‚æœä½ æƒ³é—œé–‰ LIFF è¦–çª—ï¼š
        if (liff.isInClient()) {
          liff.closeWindow();
        }
      } catch (err) {
        console.error(err);
        showError("é€å‡ºæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦æˆ–ç§è¨Šä¿å§†ã€‚");
        btn.disabled = false;
      }
    }

    document.addEventListener("DOMContentLoaded", async () => {
      await initLiff();
      setupSectionChips();
      setupTimeFlex();
      document.getElementById("btnSubmit").addEventListener("click", submitForm);
    });
  </script>
</body>
</html>
